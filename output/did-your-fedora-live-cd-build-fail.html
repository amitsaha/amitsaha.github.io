<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Did your Fedora live cd build fail?</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Programming and Writing about it Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Programming and Writing about it </a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/articles.html">Articles</a></li>
                    <li><a href="/pages/books.html">Books</a></li>
                    <li><a href="/pages/personal-projects.html">Personal Projects</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/did-your-fedora-live-cd-build-fail.html" rel="bookmark"
           title="Permalink to Did your Fedora live cd build fail?">Did your Fedora live cd build fail?</a></h1>
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="echorand">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-02-17T11:00:00+10:00">
                Published: Wed 17 February 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/amit-saha.html">Amit Saha</a>
        </address>
<p>In <a href="/category/fedora.html">Fedora</a>.</p>

</footer><!-- /.post-info -->      <p><em>Update: Changed the Koji URL to reflect the change to livemedia</em></p>
<p>As the <a class="reference external" href="http://fedora-scientific.readthedocs.org/en/latest/">Fedora Scientific</a> maintainer, I
have to make sure I look into whether the nightly build is failing so
that I can look into the why. So far I have been doing that by going to the koji <a class="reference external" href="http://koji.fedoraproject.org/koji/tasks?state=all&amp;view=tree&amp;method=livemedia">url</a>.</p>
<p>But I think there is a better way - make a program do it
regularly. First, the program (a Python script):</p>
<pre class="code literal-block">
from lxml import html
import requests

def main():
   page = requests.get('http://koji.fedoraproject.org/koji/tasks?state=all&amp;view=tree&amp;method=livemedia')
   tree = html.fromstring(page.content)

   a_class_failed = tree.xpath('//a[&#64;class=&quot;taskfailed&quot;]')
   for image in  a_class_failed:
   print image.text

if __name__ == '__main__':
   main()
</pre>
<p>This incidentally happens to be my first scraping program and I got
the help I needed <a class="reference external" href="http://docs.python-guide.org/en/latest/scenarios/scrape/">here</a>.</p>
<p>If you install the <tt class="docutils literal">requests</tt> and <tt class="docutils literal">lxml</tt> packages and run the
script, it will print the list of failing builds.</p>
<p>Next step: I want to set this up regularly and send me an email. The
script is <a class="reference external" href="https://github.com/amitsaha/fedora_livecd_build_failed/blob/master/failing_images.py">here</a>.
As you can see, I have used <a class="reference external" href="https://sendgrid.com/">sendgrid</a> to
send myself the email using their  <a class="reference external" href="https://github.com/sendgrid/sendgrid-python">Python library</a>. So you will need to
get an API key to use this program. Before you can use the script,
please install the dependencies using <tt class="docutils literal">pip install <span class="pre">-r</span>
requirements.txt</tt> preferably in it's own <a class="reference external" href="http://python-packaging-user-guide.readthedocs.org/en/develop/using-a-virtualenv/">virtualenv</a>.</p>
<p>I set this up in a cron job as follows:</p>
<pre class="code literal-block">
0 8 * * * /home/asaha/.local/share/virtualenvs/koji_scraper/bin/python /home/asaha/work/koji_livecd_scraper/python/failing_images.py
</pre>
<p>You will of course have to setup the path correctly for your setup. The script will send me an email every morning at 8 as follows:</p>
<pre class="code literal-block">
livecd (rawhide, Fedora-Live-Workstation-x86_64-rawhide, fedora-live-workstation-db37b44.ks)

createLiveCD (rawhide, Fedora-Live-Workstation-x86_64-rawhide-20160216, fedora-live-workstation-db37b44.ks, x86_64)

livecd (rawhide, Fedora-Live-Workstation-i686-rawhide, fedora-live-workstation-db37b44.ks)

createLiveCD (rawhide, Fedora-Live-Workstation-i686-rawhide-20160216, fedora-live-workstation-db37b44.ks, i386)

livecd (rawhide, Fedora-Live-Scientific_KDE-x86_64-rawhide, fedora-live-scientific_kde-db37b44.ks)

createLiveCD (rawhide, Fedora-Live-Scientific_KDE-x86_64-rawhide-20160216, fedora-live-scientific_kde-db37b44.ks, x86_64)

livecd (rawhide, Fedora-Live-Scientific_KDE-i686-rawhide, fedora-live-scientific_kde-db37b44.ks)

createLiveCD (rawhide, Fedora-Live-Scientific_KDE-i686-rawhide-20160216, fedora-live-scientific_kde-db37b44.ks, i386)
</pre>
<p>The GitHub repository for the code is available <a class="reference external" href="https://github.com/amitsaha/fedora_livecd_build_failed">here</a>.</p>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>