<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Notes on PostgreSQL | Exploring Software</title>
  <meta name="description" content="echo $RANDOM. Exploring Software and writing about it.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Notes on PostgreSQL" />
<meta property="og:description" content="Some notes on PostgreSQL which you may find useful. Thanks to all those numerous StackOverflow answers that helped me do my job at hand.
Schemas and Database The database is the highest level of organization. A database can have one or more schemas. The public schema is present by default and all tables created are created in this schema, if not otherwise specified. Learn more about it in the documentation" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://echorand.me/posts/pg-sql-notes/" />
<meta property="article:published_time" content="2019-06-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-07-11T16:52:00+10:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Notes on PostgreSQL"/>
<meta name="twitter:description" content="Some notes on PostgreSQL which you may find useful. Thanks to all those numerous StackOverflow answers that helped me do my job at hand.
Schemas and Database The database is the highest level of organization. A database can have one or more schemas. The public schema is present by default and all tables created are created in this schema, if not otherwise specified. Learn more about it in the documentation"/>

  
  
  
  <link rel="stylesheet" href="https://echorand.me/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://echorand.me/images/favicon.ico" />

  
  
  
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-108901610-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/about">About</a></li>
         
        <li><a href="/articles">Articles</a></li>
         
        <li><a href="/books">Books</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/talks">Talks</a></li>
         
        <li><a href="/categories/">Categories</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://echorand.me/posts/strace-nginx/">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://echorand.me/posts/linux_shell_autocompletion/">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&text=Notes%20on%20PostgreSQL">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&is_video=false&description=Notes%20on%20PostgreSQL">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Notes%20on%20PostgreSQL&body=Check out this article: https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-stumbleupon " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-digg " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&name=Notes%20on%20PostgreSQL&description=Some%20notes%20on%20PostgreSQL%20which%20you%20may%20find%20useful.%20Thanks%20to%20all%20those%20numerous%20StackOverflow%20answers%20that%20helped%20me%20do%20my%20job%20at%20hand.%0aSchemas%20and%20Database%20The%20database%20is%20the%20highest%20level%20of%20organization.%20A%20database%20can%20have%20one%20or%20more%20schemas.%20The%20public%20schema%20is%20present%20by%20default%20and%20all%20tables%20created%20are%20created%20in%20this%20schema%2c%20if%20not%20otherwise%20specified.%20Learn%20more%20about%20it%20in%20the%20documentation">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&t=Notes%20on%20PostgreSQL">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents"></nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Notes on PostgreSQL
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2019-06-27 00:00:00 &#43;0000 UTC" itemprop="datePublished">2019-06-27</time>
          
            (Updated: <time datetime="2019-07-11 16:52:00 &#43;1000 &#43;1000" itemprop="dateModified">2019-07-11</time>)
          
        </div>
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/software">software</a>
            
        </div>
        
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <p>Some notes on PostgreSQL which you may find useful. Thanks to all those numerous StackOverflow answers
that helped me do my job at hand.</p>
<h1 id="schemas-and-database">Schemas and Database</h1>
<p>The database is the highest level of organization. A database can have one or more <code>schemas</code>. The <code>public</code>
schema is present by default and all tables created are created in this schema, if not otherwise specified.
Learn more about it in the <a href="https://www.postgresql.org/docs/8.1/ddl-schemas.html">documentation</a></p>
<h1 id="users-and-roles">Users and roles</h1>
<p><a href="https://stackoverflow.com/questions/27709456/what-is-the-difference-between-a-user-and-a-role">What is the difference?</a></p>
<h1 id="user-creation">User creation</h1>
<p>The first thing you need to be sure of is that you are connected to the right database before you do this.
To find out the current database:</p>
<pre><code>SELECT current_database();
</code></pre><p>If the above database is not the one, you want to create the user and their grants for, reconnect
to the right database.</p>
<p>Then, we can create the user:</p>
<pre><code>
--create user &quot;readonlyuser&quot; and allow them to connect to the database &quot;dbname&quot;
CREATE USER readonlyuser WITH PASSWORD 'plaintextpassword';
GRANT CONNECT ON DATABASE dbname TO readonlyuser


--allow select on all current and future tables in the &quot;public&quot; schema
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonlyuser;
GRANT USAGE ON SCHEMA public TO readonlyuser;
ALTER DEFAULT PRIVILEGES IN SCHEMA public  GRANT SELECT ON TABLES TO readonlyuser;

</code></pre><h1 id="user-deletion">User deletion</h1>
<p>First, revoke privileges:</p>
<pre><code>ALTER DEFAULT PRIVILEGES IN SCHEMA public REVOKE SELECT ON TABLES FROM readonlyuser;
REVOKE USAGE ON SCHEMA public FROM readonlyuser;
REVOKE SELECT ON ALL TABLES IN SCHEMA public FROM readonlyuser;
REVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA public FROM readonlyuser;
REVOKE CONNECT ON DATABASE dbname FROM readonlyuser;
</code></pre><p>Now, drop the user:</p>
<pre><code>drop user readonlyuser;
</code></pre><h1 id="list-all-rolesusers">List all roles/users</h1>
<pre><code>SELECT
      r.rolname,
      r.rolsuper,
      r.rolinherit,
      r.rolcreaterole,
      r.rolcreatedb,
      r.rolcanlogin,
      r.rolconnlimit, r.rolvaliduntil,
  ARRAY(SELECT b.rolname
        FROM pg_catalog.pg_auth_members m
        JOIN pg_catalog.pg_roles b ON (m.roleid = b.oid)
        WHERE m.member = r.oid) as memberof
, r.rolreplication
, r.rolbypassrls
FROM pg_catalog.pg_roles r
ORDER BY 1;
</code></pre>
    </div>
  </article>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/about">About</a></li>
         
          <li><a href="/articles">Articles</a></li>
         
          <li><a href="/books">Books</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/talks">Talks</a></li>
         
          <li><a href="/categories/">Categories</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents"></nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&text=Notes%20on%20PostgreSQL">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&is_video=false&description=Notes%20on%20PostgreSQL">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Notes%20on%20PostgreSQL&body=Check out this article: https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&title=Notes%20on%20PostgreSQL">
      <i class="fab fa-digg fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&name=Notes%20on%20PostgreSQL&description=Some%20notes%20on%20PostgreSQL%20which%20you%20may%20find%20useful.%20Thanks%20to%20all%20those%20numerous%20StackOverflow%20answers%20that%20helped%20me%20do%20my%20job%20at%20hand.%0aSchemas%20and%20Database%20The%20database%20is%20the%20highest%20level%20of%20organization.%20A%20database%20can%20have%20one%20or%20more%20schemas.%20The%20public%20schema%20is%20present%20by%20default%20and%20all%20tables%20created%20are%20created%20in%20this%20schema%2c%20if%20not%20otherwise%20specified.%20Learn%20more%20about%20it%20in%20the%20documentation">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fechorand.me%2fposts%2fpg-sql-notes%2f&t=Notes%20on%20PostgreSQL">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2020  Exploring Software 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/about">About</a></li>
         
        <li><a href="/articles">Articles</a></li>
         
        <li><a href="/books">Books</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/talks">Talks</a></li>
         
        <li><a href="/categories/">Categories</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>



</html>
